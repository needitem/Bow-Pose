# Bullseye: 자세 인식 기반 영상 녹화 및 리플레이 시스템

## 소개

Bullseye는 MediaPipe를 활용하여 웹캠을 통해 사용자의 자세를 실시간으로 분석하고, 특정 자세(예: 양팔 벌리기)를 감지하면 자동으로 짧은 영상을 녹화하는 시스템입니다. 녹화된 영상은 Flask 웹 서버를 통해 실시간으로 스트리밍되며, 사용자는 웹 인터페이스에서 영상을 확인하고 원하는 영상을 선택하여 리플레이할 수 있습니다. 또한, 녹화된 영상은 웹캠 영상과 함께 Pygame 기반의 사용자 인터페이스(UI)에 표시됩니다.

## 주요 기능

- **실시간 자세 인식:** MediaPipe Pose 모델을 사용하여 사용자의 자세를 정확하게 인식합니다.
- **자동 녹화:** 특정 자세(예: 양팔 벌리기)를 감지하면 자동으로 5초 동안 녹화를 시작합니다.
- **영상 리플레이:** 사용자는 녹화된 영상 목록에서 원하는 영상을 선택하여 리플레이할 수 있습니다.
- **웹 인터페이스:** Flask 웹 서버를 통해 사용자에게 실시간 영상 스트리밍 및 리플레이 기능을 제공합니다.
- **Pygame UI:** 녹화 상태, 실시간 영상, 녹화된 영상을 Pygame 기반 UI로 보여줍니다.
- **커스터마이징 가능:** 녹화 시간, 저장 경로, 감지할 자세 등을 사용자의 요구에 맞게 설정할 수 있습니다.
- **오류 로깅:** Werkzeug 로거 설정을 통해 불필요한 로그를 제거하고 에러 로그만 표시합니다.

## 기술 스택

- **Python:** 주요 프로그래밍 언어
- **OpenCV:** 영상 처리
- **MediaPipe:** 자세 인식
- **Flask:** 웹 서버 및 영상 스트리밍
- **Pygame:** UI 구현
- **Numpy:** 수치 연산
- **Threading:** 멀티스레딩
- **Datetime:** 시간 관련 기능
- **OS:** 파일 및 디렉토리 관리
- **Logging:** 로깅

## 설치 및 실행 방법

### 1. 저장소 클론

먼저, 프로젝트 저장소를 로컬 머신에 클론합니다.

```bash
git clone https://github.com/yourusername/bullseye.git
cd bullseye
```

### 2. 가상 환경 설정 (선택사항)

가상 환경을 사용하여 의존성을 관리하는 것이 좋습니다.

```bash
python -m venv venv
source venv/Scripts/activate
```

### 3. 필요한 라이브러리 설치

프로젝트에 필요한 Python 라이브러리를 설치합니다.

```bash
pip install -r requirements.txt
```

### 4. 저장 폴더 생성

녹화된 영상을 저장할 폴더를 생성합니다.

```bash
path/to/create-folder
mkdir replay
```

### 5. Flask 서버 실행

Flask 서버를 실행하여 웹 인터페이스와 영상 스트리밍 기능을 시작합니다.

```bash
path/to/server.py
python server.py
```

### 6. 클라이언트 실행

클라이언트를 실행하여 웹캠 영상을 서버로 전송합니다.

```bash
path/to/client.py
python client.py
```

### 7. 웹 인터페이스 접속

웹 브라우저를 열고 다음 URL에 접속하여 실시간 영상을 확인하고 리플레이 기능을 사용할 수 있습니다.

```bash
http://localhost:5000
```

## 구성 요소 설명

### `server.py`

- **Flask 서버:** 영상 스트리밍 및 업로드를 처리하는 웹 서버를 초기화합니다.
- **Pygame UI:** 실시간 영상, 녹화 상태, 녹화된 영상 리플레이를 표시하는 사용자 인터페이스를 관리합니다.
- **MediaPipe Pose:** 사용자의 자세를 실시간으로 분석하여 특정 자세를 감지합니다.
- **멀티스레딩:** 웹캠 캡처와 Pygame UI를 독립적으로 실행하여 성능을 최적화합니다.

### `client.py`

- **영상 전송:** Picamera2를 사용하여 Raspberry Pi 카메라로부터 영상을 캡처하고 Flask 서버로 전송합니다.
- **요청 처리:** 캡처한 영상을 Flask 서버의 `/upload` 엔드포인트로 POST 요청을 통해 전송합니다.

## 참고 사항

- 프로젝트는 웹캠 영상을 실시간으로 처리하며, 웹캠이 연결되어 있지 않으면 오류가 발생합니다.
- 녹화된 영상은 프로젝트 루트 디렉토리의 `replay` 폴더에 저장됩니다.

## 설정 및 커스터마이징

### 주요 변수 설정

`server.py` 파일 내에서 다음 변수들을 수정하여 시스템을 커스터마이징할 수 있습니다.

```python
path/to/server.py
RECORDING_DURATION = 5 # 녹화 시간 설정 (초)
REPLAY_FOLDER = "./replay/" # 녹화된 영상 저장 폴더
TOGGLE_DRAWING = False # 자세 인식 결과 시각화 여부
```

### 자세 감지 로직 수정

기본적으로 양팔 벌리기 자세를 감지하도록 설정되어 있습니다. 다른 자세를 감지하려면 `calculate_angle` 함수 및 관련 로직을 수정해야 합니다.

## 사용법

1. **서버 및 클라이언트 실행:** 위의 설치 및 실행 방법을 따라 Flask 서버와 클라이언트를 실행합니다.
2. **웹 인터페이스 접근:** 웹 브라우저에서 `http://localhost:5001`에 접속합니다.
3. **실시간 영상 확인:** 웹 인터페이스에서 실시간으로 웹캠 영상을 확인할 수 있습니다.
4. **자세 인식 및 자동 녹화:** 설정된 특정 자세를 취하면 자동으로 녹화가 시작됩니다.
5. **영상 리플레이:** 녹화된 영상을 웹 인터페이스에서 선택하여 리플레이할 수 있습니다.
6. **Pygame UI 확인:** Pygame 기반의 UI 창에서 녹화 상태와 실시간 영상을 확인할 수 있습니다.

## 주의사항

- **영상 저장 형식:** 현재 .avi 확장자를 사용하여 영상을 저장합니다. 필요에 따라 다른 확장자를 사용할 수 있습니다.
- **시스템 성능:** 웹캠 캡처 스레드와 Pygame 스레드는 독립적으로 실행되므로, 시스템 성능에 영향을 미칠 수 있습니다.
- **카메라 접근 권한:** 클라이언트가 사용하는 카메라에 접근할 수 있는 권한이 필요합니다.
- **네트워크 설정:** 클라이언트와 서버가 동일한 네트워크에 있어야 원활하게 통신할 수 있습니다.

## 개선 방향

- **사용자 인터페이스 개선:** UI의 디자인과 사용자 경험을 향상시킵니다.
- **다양한 자세 감지 기능 추가:** 더 많은 자세를 감지할 수 있도록 로직을 확장합니다.
- **녹화된 영상 편집 기능 추가:** 녹화된 영상을 편집할 수 있는 기능을 추가합니다.
- **클라우드 스토리지 연동:** 녹화된 영상을 클라우드 스토리지와 연동하여 저장 및 관리합니다.
- **다른 영상 형식 지원:** 다양한 영상 포맷을 지원하여 호환성을 높입니다.
- **성능 최적화:** 멀티스레딩 및 영상 처리 성능을 최적화하여 시스템의 효율성을 향상시킵니다.

## 기여 방법

1. **이슈 생성:** 프로젝트의 이슈 트래커에 버그 보고 또는 기능 요청을 작성합니다.
2. **풀 리퀘스트 제출:** 수정 또는 기능 추가 후 풀 리퀘스트를 제출합니다.
3. **코드 리뷰:** 제출된 코드는 코드 리뷰 과정을 거칩니다.
4. **병합:** 리뷰가 완료되면 풀 리퀘스트가 병합됩니다.

## 라이선스

본 프로젝트는 MIT 라이선스를 따릅니다. 자세한 내용은 [LICENSE](LICENSE) 파일을 참고하세요.
